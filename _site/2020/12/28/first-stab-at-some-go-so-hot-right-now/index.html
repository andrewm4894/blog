<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>First stab at some Go (so hot right now) | Andrew M Blog</title>
    <link rel="stylesheet" href="/assets/css/style.css?v=">
  </head>
  <body>
    <div class="wrapper" style="display: flex; max-width: 1200px; margin: 0 auto; padding: 0 20px;">
      <!-- Main content -->
      <section style="flex: 1; max-width: 800px; margin-right: 40px;">
        <div style="margin-bottom: 2em;">
          <a href="/" style="display: inline-block; padding: 0.5em 1em; background: #f5f5f5; border-radius: 4px; text-decoration: none; color: #333;">
            ← Back to Home
          </a>
        </div>

        

        <h1>First stab at some Go (so hot right now)</h1>

        <p class="post-meta">
          <time datetime="2020-12-28T00:00:00+00:00">Dec 28, 2020
          </time><span class="categories">
            • Categories: 
            
            <span class="category">golang</span>
            
            
          </span></p>

        
        
        

<h1>First stab at some Go (so hot right now)</h1>

<p class="post-meta">
  <time datetime="2020-12-28T00:00:00+00:00">Dec 28, 2020
  </time><span class="categories">
    • Categories: 
    
    <span class="category">golang</span>
    
    
  </span></p>



<p>It may be a combination of starting to go stir crazy over the Christmas break and some self loathing at the amount of FIFA i’ve been playing that’s driven me to finally start learning some Go for a few data science and machine learning related projects i’m working on where it offers unique advantages.</p>

<p>(In reality, the final straw here was a long discussion with an SRE colleague who explained to me how much easier it would be for us to ship the ML code in Go vs Python which should, for our project, ultimately make it easier for people to adopt and use the ML powered features - which is really what i’m most interested in, even if i may not yet have as many fancy ML models and libraries to leverage in Go).</p>

<p>So the first step of my journey is actually pulling the data (using asynchronous goroutines - like i said, so hot right now) i need from a list of api endpoints and basically shoving it into the equivalent of a <a href="https://pandas.pydata.org/">Pandas</a> dataframe in Go.</p>

<p>I am using the <a href="https://github.com/go-gota/gota">Gota</a> package, but there is also a few others you can see <a href="https://github.com/avelino/awesome-go#data-structures">here</a>.</p>

<p>So after a bit of searching around and some YouTube videos below is a verbosely commented version of what i have that i think is a decent enough starting point for now (would appreciate any tips if you know Go and have any suggestions).</p>

<p>I think i might actually quite like this Go malarky, or at least continue learning it to make me feel like the hipster i really wish i was.</p>

<p>p.s. I will probably make some more posts as I learn more.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span><span class="err"> </span><span class="n">main</span>

<span class="k">import</span><span class="err"> </span><span class="p">(</span>
<span class="err">    </span><span class="s">"fmt"</span>
<span class="err">    </span><span class="s">"io/ioutil"</span>
<span class="err">    </span><span class="s">"net/http"</span>
<span class="err">    </span><span class="s">"regexp"</span>
<span class="err">    </span><span class="s">"strings"</span>
<span class="err">    </span><span class="s">"sync"</span>

<span class="err">    </span><span class="s">"github.com/go-gota/gota/dataframe"</span>
<span class="p">)</span>

<span class="c">// Create a wait group</span>
<span class="k">var</span><span class="err"> </span><span class="n">wg</span><span class="err"> </span><span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>

<span class="c">// Get api response (expects format=csv) and make a dataframe from it</span>
<span class="k">func</span><span class="err"> </span><span class="n">getDf</span><span class="p">(</span><span class="n">url</span><span class="err"> </span><span class="kt">string</span><span class="p">,</span><span class="err"> </span><span class="n">c</span><span class="err"> </span><span class="k">chan</span><span class="err"> </span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span><span class="err"> </span><span class="p">{</span>

<span class="err">    </span><span class="c">// Need to make sure we tell wait group we done</span>
<span class="err">    </span><span class="k">defer</span><span class="err"> </span><span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>

<span class="err">    </span><span class="c">// Pull chart name from the url</span>
<span class="err">    </span><span class="n">re</span><span class="err"> </span><span class="o">:=</span><span class="err"> </span><span class="n">regexp</span><span class="o">.</span><span class="n">MustCompile</span><span class="p">(</span><span class="s">"chart=(.*?)&amp;"</span><span class="p">)</span>
<span class="err">    </span><span class="n">match</span><span class="err"> </span><span class="o">:=</span><span class="err"> </span><span class="n">re</span><span class="o">.</span><span class="n">FindStringSubmatch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="err">    </span><span class="n">chart</span><span class="err"> </span><span class="o">:=</span><span class="err"> </span><span class="n">match</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="err">    </span><span class="n">resp</span><span class="p">,</span><span class="err"> </span><span class="n">_</span><span class="err"> </span><span class="o">:=</span><span class="err"> </span><span class="n">http</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="err">    </span><span class="c">// Get body as string for ReadCSV</span>
<span class="err">    </span><span class="n">bodyBytes</span><span class="p">,</span><span class="err"> </span><span class="n">_</span><span class="err"> </span><span class="o">:=</span><span class="err"> </span><span class="n">ioutil</span><span class="o">.</span><span class="n">ReadAll</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="p">)</span>
<span class="err">    </span><span class="n">bodyString</span><span class="err"> </span><span class="o">:=</span><span class="err"> </span><span class="kt">string</span><span class="p">(</span><span class="n">bodyBytes</span><span class="p">)</span>
<span class="err">    </span><span class="n">df</span><span class="err"> </span><span class="o">:=</span><span class="err"> </span><span class="n">dataframe</span><span class="o">.</span><span class="n">ReadCSV</span><span class="p">(</span><span class="n">strings</span><span class="o">.</span><span class="n">NewReader</span><span class="p">(</span><span class="n">bodyString</span><span class="p">))</span>

<span class="err">    </span><span class="c">// Add chart suffix to each col name</span>
<span class="err">    </span><span class="c">// (ignore first col which should be "time" and used for joins later)</span>
<span class="err">    </span><span class="n">colnames</span><span class="err"> </span><span class="o">:=</span><span class="err"> </span><span class="n">df</span><span class="o">.</span><span class="n">Names</span><span class="p">()</span>
<span class="err">    </span><span class="k">for</span><span class="err"> </span><span class="n">i</span><span class="p">,</span><span class="err"> </span><span class="n">colname</span><span class="err"> </span><span class="o">:=</span><span class="err"> </span><span class="k">range</span><span class="err"> </span><span class="n">colnames</span><span class="err"> </span><span class="p">{</span>
<span class="err">        </span><span class="k">if</span><span class="err"> </span><span class="n">i</span><span class="err"> </span><span class="o">!=</span><span class="err"> </span><span class="m">0</span><span class="err"> </span><span class="p">{</span>
<span class="err">            </span><span class="n">df</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">df</span><span class="o">.</span><span class="n">Rename</span><span class="p">(</span><span class="n">chart</span><span class="o">+</span><span class="s">"|"</span><span class="o">+</span><span class="n">colname</span><span class="p">,</span><span class="err"> </span><span class="n">colname</span><span class="p">)</span>
<span class="err">        </span><span class="p">}</span>
<span class="err">    </span><span class="p">}</span>

<span class="err">    </span><span class="c">// send df to channel</span>
<span class="err">    </span><span class="n">c</span><span class="err"> </span><span class="o">&lt;-</span><span class="err"> </span><span class="n">df</span>

<span class="p">}</span>

<span class="k">func</span><span class="err"> </span><span class="n">main</span><span class="p">()</span><span class="err"> </span><span class="p">{</span>

<span class="err">    </span><span class="c">// Define a list of api calls we want data from</span>
<span class="err">    </span><span class="c">// In this example we have an api call for each chart data we want in our df</span>
<span class="err">    </span><span class="n">urls</span><span class="err"> </span><span class="o">:=</span><span class="err"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
<span class="err">        </span><span class="s">"https://london.my-netdata.io/api/v1/data?chart=system.cpu&amp;format=csv&amp;after=-10"</span><span class="p">,</span>
<span class="err">        </span><span class="s">"https://london.my-netdata.io/api/v1/data?chart=system.net&amp;format=csv&amp;after=-10"</span><span class="p">,</span>
<span class="err">        </span><span class="s">"https://london.my-netdata.io/api/v1/data?chart=system.load&amp;format=csv&amp;after=-10"</span><span class="p">,</span>
<span class="err">        </span><span class="s">"https://london.my-netdata.io/api/v1/data?chart=system.io&amp;format=csv&amp;after=-10"</span><span class="p">,</span>
<span class="err">    </span><span class="p">}</span>

<span class="err">    </span><span class="c">// Create a channel of dataframes the size of number of api calls we need to make</span>
<span class="err">    </span><span class="n">dfChannel</span><span class="err"> </span><span class="o">:=</span><span class="err"> </span><span class="nb">make</span><span class="p">(</span><span class="k">chan</span><span class="err"> </span><span class="n">dataframe</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span><span class="err"> </span><span class="nb">len</span><span class="p">(</span><span class="n">urls</span><span class="p">))</span>

<span class="err">    </span><span class="c">// Create empty df we will outer join into from the df channel later</span>
<span class="err">    </span><span class="n">df</span><span class="err"> </span><span class="o">:=</span><span class="err"> </span><span class="n">dataframe</span><span class="o">.</span><span class="n">ReadJSON</span><span class="p">(</span><span class="n">strings</span><span class="o">.</span><span class="n">NewReader</span><span class="p">(</span><span class="s">`[{"time":"1900-01-01 00:00:01"}]`</span><span class="p">))</span>

<span class="err">    </span><span class="c">// Kick off a go routine for each url</span>
<span class="err">    </span><span class="k">for</span><span class="err"> </span><span class="n">_</span><span class="p">,</span><span class="err"> </span><span class="n">url</span><span class="err"> </span><span class="o">:=</span><span class="err"> </span><span class="k">range</span><span class="err"> </span><span class="n">urls</span><span class="err"> </span><span class="p">{</span>
<span class="err">        </span><span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="err">        </span><span class="k">go</span><span class="err"> </span><span class="n">getDf</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="err"> </span><span class="n">dfChannel</span><span class="p">)</span>
<span class="err">    </span><span class="p">}</span>

<span class="err">    </span><span class="c">// Handle synchronization of channel</span>
<span class="err">    </span><span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
<span class="err">    </span><span class="nb">close</span><span class="p">(</span><span class="n">dfChannel</span><span class="p">)</span>

<span class="err">    </span><span class="c">// Pull each df from the channel and outer join onto our original empty df</span>
<span class="err">    </span><span class="k">for</span><span class="err"> </span><span class="n">dfTmp</span><span class="err"> </span><span class="o">:=</span><span class="err"> </span><span class="k">range</span><span class="err"> </span><span class="n">dfChannel</span><span class="err"> </span><span class="p">{</span>
<span class="err">        </span><span class="n">df</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">df</span><span class="o">.</span><span class="n">OuterJoin</span><span class="p">(</span><span class="n">dfTmp</span><span class="p">,</span><span class="err"> </span><span class="s">"time"</span><span class="p">)</span>
<span class="err">    </span><span class="p">}</span>

<span class="err">    </span><span class="c">// Sort based on time</span>
<span class="err">    </span><span class="n">df</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="n">df</span><span class="o">.</span><span class="n">Arrange</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">Sort</span><span class="p">(</span><span class="s">"time"</span><span class="p">))</span>

<span class="err">    </span><span class="c">// Print df</span>
<span class="err">    </span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="err"> </span><span class="m">10</span><span class="p">,</span><span class="err"> </span><span class="m">5</span><span class="p">)</span>

<span class="err">    </span><span class="c">// Describe df</span>
<span class="err">    </span><span class="c">//fmt.Println(df.Describe())</span>

<span class="p">}</span>
</code></pre></div></div>

<p>Which should return something that looks kinda like a Pandas DataFrame!</p>

<figure>

<img src="/assets/images/2020-12-28-first-stab-at-some-go-so-hot-right-now/go-1-1024x467.jpg

<figcaption>

Yes Powershell, come at me bro!

</figcaption>

</figure>

<p>Here is a list of some useful links and resources i’ve used to get this far:</p>

<ul>
  <li>Great <a href="https://www.youtube.com/watch?v=YS4e4q9oBaU">freeCodeCamp course</a> (first time i’ve used anything from freeCodeCamp - was very impressed and have subscribed!).</li>
  <li>Stumbled upon <a href="https://pythonprogramming.net/go/introduction-go-language-programming-tutorial/">this Go series</a> from sentdex which was great as I love everything he does.</li>
  <li>A <a href="https://www.youtube.com/watch?v=LvgVSSpwND8">really clear video</a> from <a href="https://twitter.com/jakewrightuk">Jake Wright</a>.</li>
  <li><a href="https://github.com/avelino/awesome-go#data-structures">Awesome Go list</a> because of course.</li>
  <li>A more higher level <a href="https://www.youtube.com/watch?v=gwg_YXyCYBw">Go DS/ML related talk</a> from <a href="https://twitter.com/samkreter">Sam Kreter</a>.</li>
</ul>


<style>
.cover-image {
  margin-bottom: 2em;
  max-width: 100%;
  overflow: hidden;
}

.cover-image img {
  width: 100%;
  height: auto;
  display: block;
}

.post-meta {
  color: #666;
  margin-bottom: 2em;
}

.category {
  font-style: italic;
}

figure {
  margin: 1.5em 0;
  text-align: center;
}

figure img {
  max-width: 100%;
  height: auto;
  display: block;
  margin: 0 auto;
}

figcaption {
  color: #666;
  font-style: italic;
  margin-top: 0.5em;
}

img {
  max-width: 100%;
  height: auto;
  display: block;
  margin: 1em auto;
}

code {
  padding: 0.2em 0.4em;
  background-color: #f6f8fa;
  border-radius: 3px;
  font-size: 85%;
}

pre code {
  padding: 0;
  background-color: transparent;
}

.language-plaintext {
  color: #24292e;
}

.language-python {
  color: #24292e;
}
</style> 

        <div style="margin-top: 2em; text-align: center;">
          <a href="/" style="display: inline-block; margin: 1em;">← Back to Home</a>
        </div>
      </section>

      <!-- Right sidebar -->
      <aside style="width: 300px; margin-top: 6em;">
        <div style="position: sticky; top: 20px;">
          <h3 style="margin-top: 0;">Recent Posts</h3>
          <div class="posts-list">
            
              <article style="margin-bottom: 1.5em;">
                <h4 style="margin: 0;">
                  <a href="/2024/12/19/bolt-new-vs-o1-some-thoughts/" >
                    bolt.new vs o1 - some thoughts
                  </a>
                </h4>
                <time style="font-size: 0.9em; color: #666;">
                  December 19, 2024
                </time>
              </article>
            
              <article style="margin-bottom: 1.5em;">
                <h4 style="margin: 0;">
                  <a href="/2024/12/03/anomstack-data-engineering-podcast/" >
                    Anomstack - Data Engineering Podcast
                  </a>
                </h4>
                <time style="font-size: 0.9em; color: #666;">
                  December 03, 2024
                </time>
              </article>
            
              <article style="margin-bottom: 1.5em;">
                <h4 style="margin: 0;">
                  <a href="/2024/03/04/weights-biases-log-keras-model-summary-architecture/" >
                    Weights &amp; Biases - log Keras model summary &amp; architecture
                  </a>
                </h4>
                <time style="font-size: 0.9em; color: #666;">
                  March 04, 2024
                </time>
              </article>
            
              <article style="margin-bottom: 1.5em;">
                <h4 style="margin: 0;">
                  <a href="/2023/12/20/mlops-community-podcast/" >
                    MLOps Community Podcast!!!
                  </a>
                </h4>
                <time style="font-size: 0.9em; color: #666;">
                  December 20, 2023
                </time>
              </article>
            
              <article style="margin-bottom: 1.5em;">
                <h4 style="margin: 0;">
                  <a href="/2023/11/06/the-future-of-machine-learning-and-ai-panel-discussion-civo-navigate-europe-23/" >
                    The Future of Machine Learning and AI Panel Discussion - Civo Navigate Europe 23
                  </a>
                </h4>
                <time style="font-size: 0.9em; color: #666;">
                  November 06, 2023
                </time>
              </article>
            
              <article style="margin-bottom: 1.5em;">
                <h4 style="margin: 0;">
                  <a href="/2023/10/25/10-practical-ml-use-cases-in-observability/" >
                    10 Practical ML Use Cases in Observability
                  </a>
                </h4>
                <time style="font-size: 0.9em; color: #666;">
                  October 25, 2023
                </time>
              </article>
            
              <article style="margin-bottom: 1.5em;">
                <h4 style="margin: 0;">
                  <a href="/2023/07/01/malloy-seems-petty-cool/" >
                    Malloy seems petty cool...
                  </a>
                </h4>
                <time style="font-size: 0.9em; color: #666;">
                  July 01, 2023
                </time>
              </article>
            
              <article style="margin-bottom: 1.5em;">
                <h4 style="margin: 0;">
                  <a href="/2023/05/18/painless-anomaly-detection-with-apache-airflow/" >
                    Painless Anomaly Detection with Apache Airflow
                  </a>
                </h4>
                <time style="font-size: 0.9em; color: #666;">
                  May 18, 2023
                </time>
              </article>
            
              <article style="margin-bottom: 1.5em;">
                <h4 style="margin: 0;">
                  <a href="/2022/12/22/stripe-webhook-gcp-functions-framework-python/" >
                    Stripe Webhook + GCP Functions Framework (Python)
                  </a>
                </h4>
                <time style="font-size: 0.9em; color: #666;">
                  December 22, 2022
                </time>
              </article>
            
              <article style="margin-bottom: 1.5em;">
                <h4 style="margin: 0;">
                  <a href="/2022/10/20/colab-to-just-run-some-curl/" >
                    Colab to just run some curl
                  </a>
                </h4>
                <time style="font-size: 0.9em; color: #666;">
                  October 20, 2022
                </time>
              </article>
            
            
              <p style="margin-top: 1em;">
                <a href="/" style="color: #666;">View all posts →</a>
              </p>
            
          </div>
        </div>
      </aside>

      <style>
        .cover-image {
          margin-bottom: 2em;
          max-width: 100%;
          overflow: hidden;
        }

        .cover-image img {
          width: 100%;
          height: auto;
          display: block;
        }

        .post-meta {
          color: #666;
          margin-bottom: 2em;
        }

        .category {
          font-style: italic;
        }

        figure {
          margin: 1.5em 0;
          text-align: center;
        }

        figure img {
          max-width: 100%;
          height: auto;
          display: block;
          margin: 0 auto;
        }

        figcaption {
          color: #666;
          font-style: italic;
          margin-top: 0.5em;
        }

        img {
          max-width: 100%;
          height: auto;
          display: block;
          margin: 1em auto;
        }

        code {
          padding: 0.2em 0.4em;
          background-color: #f6f8fa;
          border-radius: 3px;
          font-size: 85%;
        }

        pre code {
          padding: 0;
          background-color: transparent;
        }

        .language-plaintext {
          color: #24292e;
        }

        .language-python {
          color: #24292e;
        }

        .posts-list h4 a {
          color: #333;
          text-decoration: none;
        }

        .posts-list h4 a:hover {
          color: #267CB9;
        }

        .posts-list .current-post {
          color: #267CB9;
          font-weight: bold;
        }

        @media screen and (max-width: 1000px) {
          .wrapper {
            flex-direction: column;
          }
          
          section {
            margin-right: 0;
          }

          aside {
            width: 100%;
            margin-top: 3em;
          }
        }
      </style>
    </div>
  </body>
</html> 